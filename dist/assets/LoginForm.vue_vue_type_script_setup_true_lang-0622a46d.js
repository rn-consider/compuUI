import{E as e,u as a,F as o,a as s}from"./useValidator-404953e8.js";import{x as t,y as l,d as r,Z as n,B as i,o as d,c,i as u,w as p,I as m,a as f,H as g,J as h,n as v,K as w,O as y,$ as b,b as R,s as k,u as P,a0 as I,e as x,L as j,a1 as E,r as A,a2 as C,U as z,a3 as _,k as $}from"./index-97d55404.js";import{E as F}from"./el-button-88ca4579.js";import{l as L,g as S,a as q}from"./index-1b14301a.js";const B=t({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},href:{type:String,default:""},icon:{type:l}}),D={click:e=>e instanceof MouseEvent},O=["href"],U=r({name:"ElLink"});const V=b(y(r({...U,props:B,emits:D,setup(e,{emit:a}){const o=e,s=n("link"),t=i((()=>[s.b(),s.m(o.type),s.is("disabled",o.disabled),s.is("underline",o.underline&&!o.disabled)]));function l(e){o.disabled||a("click",e)}return(e,a)=>(d(),c("a",{class:v(f(t)),href:e.disabled||!e.href?void 0:e.href,onClick:l},[e.icon?(d(),u(f(g),{key:0},{default:p((()=>[(d(),u(m(e.icon)))])),_:1})):h("v-if",!0),e.$slots.default?(d(),c("span",{key:1,class:v(f(s).e("inner"))},[w(e.$slots,"default")],2)):h("v-if",!0),e.$slots.icon?w(e.$slots,"icon",{key:2}):h("v-if",!0)],10,O))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/link/src/link.vue"]]));function M(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!z(e)}const H="#999",J="var(--el-color-primary)",K=r({__name:"LoginForm",emits:["to-register"],setup(t,{emit:l}){const{required:r}=s(),n=R(),i=k(),{currentRoute:c,addRoute:p,push:m}=P(),{setStorage:g}=_(),{t:h}=$(),v={username:[r()],password:[r()]},w=I([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>x("h2",{class:"text-2xl font-bold text-center w-[100%]"},[h("login.login")])}}},{field:"username",label:h("login.username"),value:"admin",component:"Input",colProps:{span:24},componentProps:{placeholder:h("login.usernamePlaceholder")}},{field:"password",label:h("login.password"),value:"admin",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:h("login.passwordPlaceholder")}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>{let a;return x(j,null,[x("div",{class:"flex justify-between items-center w-[100%]"},[x(e,{modelValue:y.value,"onUpdate:modelValue":e=>y.value=e,label:h("login.remember"),size:"small"},null),x(V,{type:"primary",underline:!1},M(a=h("login.forgetPassword"))?a:{default:()=>[a]})])])}}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,a;return x(j,null,[x("div",{class:"w-[100%]"},[x(F,{loading:O.value,type:"primary",class:"w-[100%]",onClick:K},M(e=h("login.login"))?e:{default:()=>[e]})]),x("div",{class:"w-[100%] mt-15px"},[x(F,{class:"w-[100%]",onClick:Z},M(a=h("login.register"))?a:{default:()=>[a]})])])}}}},{field:"other",component:"Divider",label:h("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>x(j,null,[x("div",{class:"flex justify-between w-[100%]"},[x(E,{icon:"ant-design:github-filled",size:30,class:"cursor-pointer ant-icon",color:H,hoverColor:J},null),x(E,{icon:"ant-design:wechat-filled",size:30,class:"cursor-pointer ant-icon",color:H,hoverColor:J},null),x(E,{icon:"ant-design:alipay-circle-filled",size:30,color:H,hoverColor:J,class:"cursor-pointer ant-icon"},null),x(E,{icon:"ant-design:weibo-circle-filled",size:30,color:H,hoverColor:J,class:"cursor-pointer ant-icon"},null)])])}}}]),y=A(!1),{formRegister:b,formMethods:z}=a(),{getFormData:B,getElFormExpose:D}=z,O=A(!1),U=A("");C((()=>c.value),(e=>{var a;U.value=null==(a=null==e?void 0:e.query)?void 0:a.redirect}),{immediate:!0});const K=async()=>{await i.generateRoutes("none").catch((()=>{})),i.getAddRouters.forEach((e=>{p(e)})),i.setIsAddRouters(!0),m({path:U.value||i.addRouters[0].path});const e=await D();await(null==e?void 0:e.validate((async e=>{if(e){O.value=!0;const e=await B();try{const a=await L(e);a&&(g(n.getUserInfo,a.data),n.getDynamicRouter?N():(await i.generateRoutes("none").catch((()=>{})),i.getAddRouters.forEach((e=>{p(e)})),i.setIsAddRouters(!0),m({path:U.value||i.addRouters[0].path})))}finally{O.value=!1}}})))},N=async()=>{const e=await B(),a={roleName:e.username},o="admin"===e.username?await S(a):await q(a);if(o){const a=o.data||[];g("roleRouters",a),"admin"===e.username?await i.generateRoutes("admin",a).catch((()=>{})):await i.generateRoutes("test",a).catch((()=>{})),i.getAddRouters.forEach((e=>{p(e)})),i.setIsAddRouters(!0),m({path:U.value||i.addRouters[0].path})}},Z=()=>{l("to-register")};return(e,a)=>(d(),u(f(o),{schema:w,rules:v,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:f(b)},null,8,["schema","onRegister"]))}});export{K as _};
